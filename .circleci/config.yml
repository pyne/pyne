version: 2
jobs:
  build_py3:
    docker:
      - image: pyne/pyne_ubuntu_17.04:latest

    working_directory: ~/repo

    steps:
      - checkout

      # Build!
      - run:
          name: Building PyNE
          command: |
            python3 setup.py install --user -j 3 \
                -DMOAB_LIBRARY=$HOME/opt/moab/lib \
                -DMOAB_INCLUDE_DIR=$HOME/opt/moab/include
            cd ~
            nuc_data_make

      # Test!
      - run:
          name: Running PyNE Tests
          command: |
            cd ~/repo/tests
            nosetests3

  build_py2:
    docker:
      - image: pyne/pyne_ubuntu_16.04:latest

    working_directory: ~/repo

    steps:
      - checkout

      # Build!
      - run:
          name: Building PyNE
          command: |
            python setup.py install --user \
                -DMOAB_LIBRARY=$HOME/opt/moab/lib \
                -DMOAB_INCLUDE_DIR=$HOME/opt/moab/include
            cd ~
            nuc_data_make

      # Test!
      - run:
          name: Running PyNE Tests
          command: |
            cd ~/repo/tests
            nosetests

