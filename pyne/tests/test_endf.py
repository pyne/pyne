import numpy as np
from pyne.endf import Library
from StringIO import StringIO

fakedata = ''' $Rev:: 532      $  $Date:: 2011-12-05#$                             1 0  0    0
 1.002000+3 1.996800+0          0          0          0          0 128 1451    1
 0.000000+0 0.000000+0          0          0          0          6 128 1451    2
 1.000000+0 1.500000+8          1          0         10          7 128 1451    3
 0.000000+0 0.000000+0          0          0        211         17 128 1451    4
  1-H -  2 LANL       EVAL-FEB97 P.G.Young,G.M.Hale,M.B.Chadwick   128 1451    5
 CH97,CH99            DIST-DEC06                       20111222    128 1451    6
----ENDF/B-VII.1      MATERIAL  128                                128 1451    7
-----INCIDENT NEUTRON DATA                                         128 1451    8
------ENDF-6 FORMAT                                                128 1451    9
                                                                   128 1451   10
 ****************************************************************  128 1451   11
                                                                   128 1451   12
 Covariances were adopted from COMMARA-2.0 in July 2011.           128 1451   13
 Covariances are supplied for elastic, (n,2n) and radiative        128 1451   14
 capture. Covariances were estimated at LANL based on a brief      128 1451   15
 analysis of experimental data and their agreement with the        128 1451   16
 ENDF/B-VII.0 central values.                                      128 1451   17
                                                                   128 1451   18
 ************************ C O N T E N T S ************************ 128 1451   19
                                1        451         27          0 128 1451   20
                                2        151          1          0 128 1451   21
                                3          1          1          0 128 1451   22
                                3          2          1          0 128 1451   23
                                3          3          1          0 128 1451   24
                                3         16          1          0 128 1451   25
                                3        102          2          0 128 1451   26
                                4          2          1          0 128 1451   27
 0.000000+0 0.000000+0          0          0          0          0 128 1  099999
 0.000000+0 0.000000+0          0          0          0          0 128 0  0    0
 1.002000+3 1.996800+0          0          0          1          0 128 2151    1
 0.000000+0 0.000000+0          0          0          0          0 128 2  099999
 0.000000+0 0.000000+0          0          0          0          0 128 0  0    0
 1.002000+3 1.996800+0          0          0          0          0 128 3  1    1
 0.000000+0 0.000000+0          0          0          0          0 128 3  099999
 1.002000+3 1.996800+0          0          0          0          0 128 3  2    1
 0.000000+0 0.000000+0          0          0          0          0 128 3  099999
 1.002000+3 1.996800+0          0          0          0          0 128 3  3    1
 0.000000+0 0.000000+0          0          0          0          0 128 3  099999
 1.002000+3 1.996800+0          1          0          0          0 128 3 16    1
 0.000000+0 0.000000+0          0          0          0          0 128 3  099999
 1.002000+3 1.996800+0          0          0          0          0 128 3102    1
 2.450000+6 8.413251-6 2.500000+6 8.470750-6-2.750000+6 8.743445-6 128 3102    2
 0.000000+0 0.000000+0          0          0          0          0 128 3  099999
 0.000000+0 0.000000+0          0          0          0          0 128 0  0    0
 1.002000+3 1.996800+0          0          2          0          0 128 4  2    1
 0.000000+0 0.000000+0          0          0          0          0 128 4  099999
 0.000000+0 0.000000+0          0          0          0          0 128 0  0    0
 0.000000+0 0.000000+0          0          0          0          0   0 0  0    0
 0.000000+0 0.000000+0          0          0          0          0  -1 0  0    0
 $Rev:: 532      $  $Date:: 2011-12-05#$                             1 0  0    0
 1.003000+3 2.989596+0          0          0          0          1 131 1451    1
 0.000000+0 1.000000+0          0          0          0          6 131 1451    2
 1.000000+0 2.000000+7          1          0         10          7 131 1451    3
 0.000000+0 0.000000+0          0          0         90          8 131 1451    4
  1-H -  3 LANL       EVAL-NOV01 G.M.Hale                          131 1451    5
PRC  42, 438 (1990)   DIST-DEC06                       20111222    131 1451    6
----ENDF/B-VII.1      MATERIAL  131                                131 1451    7
-----INCIDENT NEUTRON DATA                                         131 1451    8
------ENDF-6 FORMAT                                                131 1451    9
                                                                   131 1451   10
*** (n,2n) replaced by ENDF/B-VI.8, total adjusted (NNDC/2010/06 * 131 1451   11
n-t scattering evaluation, based on an R-matrix analysis of p-3He  131 1451   12
scattering that was transformed from the 4Li system to the 4H      131 1451   13
*****************************************************************  131 1451   14
                                                                   131 1451   15
                                1        451         21          1 131 1451   16
                                2        151          1          1 131 1451   17
                                3          1          1          1 131 1451   18
                                3          2          1          1 131 1451   19
                                3         16          1          1 131 1451   20
                                4          2          1          1 131 1451   21
 0.000000+0 0.000000+0          0          0          0          0 131 1  099999
 0.000000+0 0.000000+0          0          0          0          0 131 0  0    0
 1.003000+3 2.989596+0          0          0          1          0 131 2151    1
 0.000000+0 0.000000+0          0          0          0          0 131 2  099999
 0.000000+0 0.000000+0          0          0          0          0 131 0  0    0
 1.003000+3 2.989596+0          0          0          0          0 131 3  1    1
 0.000000+0 0.000000+0          0          0          0          0 131 3  099999
 1.003000+3 2.989596+0          0          0          0          0 131 3  2    1
 0.000000+0 0.000000+0          0          0          0          0 131 3  099999
 1.003000+3 2.989596+0          0          0          0          0 131 3 16    1
 0.000000+0 0.000000+0          0          0          0          0 131 3  099999
 0.000000+0 0.000000+0          0          0          0          0 131 0  0    0
 1.003000+3 2.989596+0          0          1          0          0 131 4  2    1
 0.000000+0 0.000000+0          0          0          0          0 131 4  099999
 0.000000+0 0.000000+0          0          0          0          0 131 0  0    0
 0.000000+0 0.000000+0          0          0          0          0   0 0  0    0
 0.000000+0 0.000000+0          0          0          0          0  -1 0  0    0
 $Rev:: 532      $  $Date:: 2011-12-05#$                             1 0  0    0
 4.007000+3 6.954500+0          0          0          0          1 419 1451    1
 0.000000+0 0.000000+0          0          0          0          6 419 1451    2
 1.000000+0 8.100000+6          1          0         10          7 419 1451    3
 0.000000+0 0.000000+0          0          0         47         10 419 1451    4
  4-Be-  7 LANL       EVAL-JUN04 P.R.Page                          419 1451    5
                      DIST-DEC06                       20111222    419 1451    6
----ENDF/B-VII.1      MATERIAL  419                                419 1451    7
-----INCIDENT NEUTRON DATA                                         419 1451    8
------ENDF-6 FORMAT                                                419 1451    9
                                                                   419 1451   10
 ***************************************************************** 419 1451   11
REACTIONS:  7Be(n,n) (MT=2), 7Be(n,p) (MT=600), 7Be(n,d) (MT=650)  419 1451   12
and 7Be(n,alpha) (MT=800) calculated from R-matrix analysis of     419 1451   13
reactions in the 8Be system.                                       419 1451   14
 ***************************************************************** 419 1451   15
                                1        451         22          1 419 1451   16
                                2        151          1          1 419 1451   17
                                3          2          1          1 419 1451   18
                                3        600          1          1 419 1451   19
                                3        650          1          1 419 1451   20
                                3        800          1          1 419 1451   21
                                4          2          1          1 419 1451   22
 0.000000+0 0.000000+0          0          0          0          0 419 1  099999
 0.000000+0 0.000000+0          0          0          0          0 419 0  0    0
 4.007000+3 6.954500+0          0          0          1          0 419 2151    1
 0.000000+0 0.000000+0          0          0          0          0 419 2  099999
 0.000000+0 0.000000+0          0          0          0          0 419 0  0    0
 4.007000+3 6.954500+0          0          0          0          0 419 3  2    1
 0.000000+0 0.000000+0          0          0          0          0 419 3  099999
 4.007000+3 6.954500+0          0          0          0          0 419 3600    1
 0.000000+0 0.000000+0          0          0          0          0 419 3  099999
 4.007000+3 6.954500+0          0          0          0          0 419 3650    1
 0.000000+0 0.000000+0          0          0          0          0 419 3  099999
 4.007000+3 6.954500+0          0          0          0          0 419 3800    1
 0.000000+0 0.000000+0          0          0          0          0 419 3  099999
 0.000000+0 0.000000+0          0          0          0          0 419 0  0    0
 4.007000+3 6.954500+0          0          1          0          0 419 4  2    1
 0.000000+0 0.000000+0          0          0          0          0 419 4  099999
 0.000000+0 0.000000+0          0          0          0          0 419 0  0    0
 0.000000+0 0.000000+0          0          0          0          0   0 0  0    0
 0.000000+0 0.000000+0          0          0          0          0  -1 0  0    0
'''

library = Library(fakedata)
    
def test_mats:
    for mat_id in library.mats:
        assert_in(mat_id, [128, 131, 419])

def test_section_end_offsets
    expected = np.array([1.002000+3,
                         1.996800+0,
                         1,
                         0,
                         0,
                         0],
                        dtype = float)
    assert_equal(library.read_mfmt(128,3,16), expected)

# def test_read_multiple_lines:
    # expected = np.array([1.002000+3 1.996800+0          0          0          0          0 128 3102    1
 # 2.450000+6 8.413251-6 2.500000+6 8.470750-6-2.750000+6 8.743445-6 128 3102    2]
# test_file_end_offsets
# test_material_end_offsets
# print '6174, 6204'
# print test.read_mfmt(128, 33, 16)
# print '6924, 6948'
# print test.read_mfmt(131, 2, 151)
# print '12672:12696'
# print test.read_mfmt(419, 2, 151)
